<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Tracker</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0iIzNiODJmNiIvPjxwYXRoIGQ9Ik0xMC43NSA0QTcuNzUgNy43NSAwIDAwMyAxMS43NXY0LjVBNy43NSA3Ljc1IDAgMDAxMC43NSAyNGgxLjVBNy43NSA3Ljc1IDAgMDAyMCAxNi4yNXYtNC41QTcuNzUgNy43NSAwIDAwMTIuMjUgNGgtMS41ek0xMiA4YTEgMSAwIDAwLTEgMXY2YTEgMSAwIDEwMiAwVjlhMSAxIDAgMDAtMS0xeiIgZmlsbD0id2hpdGUiLz48L3N2Zz4=">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/dexie@3.2.4/dist/dexie.js"></script>
    <link rel="stylesheet" href="/styles.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Offline banner -->
    <div id="offline-banner" class="offline-banner hidden">
        üì° Offline - Changes will sync when online
    </div>

    <!-- Main App Container -->
    <div id="app" class="max-w-md mx-auto bg-white min-h-screen shadow-lg">
        <!-- Loading Screen -->
        <div id="loading-screen" class="flex items-center justify-center h-screen">
            <div class="text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                <p class="text-gray-600">Loading Workout Tracker...</p>
            </div>
        </div>

        <!-- Auth Error Screen -->
        <div id="auth-error-screen" class="hidden p-6 pt-16">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">üîí Authentication Required</h1>
                <p class="text-gray-600">Please log in through Authelia to access the Workout Tracker</p>
            </div>

            <div class="bg-red-50 border border-red-200 rounded-md p-4 mb-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-red-800">Authentication Error</h3>
                        <p class="text-sm text-red-700 mt-1">You are not authenticated via Authelia. Please ensure you are logged in through the authentication portal.</p>
                    </div>
                </div>
            </div>

            <div class="space-y-4">
<<<<<<< HEAD
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                    <input type="text" id="username" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Enter username">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Enter password">
                </div>
                <button id="login-btn" class="w-full bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600 transition-colors">
                    Login
                </button>
                
                <div class="text-center mt-4">
                    <button id="forgot-password-btn" class="text-sm text-blue-500 hover:text-blue-600">
                        Forgot your password?
                    </button>
                </div>

            </div>
            
            <!-- Forgot Password Form -->
            <div id="forgot-password-form" class="hidden space-y-4">
                <div class="text-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">Reset Password</h2>
                    <p class="text-sm text-gray-600">Enter your email address and we'll send you a reset link</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                    <input type="email" id="reset-email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Enter your email">
                </div>
                
                <button id="send-reset-btn" class="w-full bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600 transition-colors">
                    Send Reset Link
                </button>
                
                <div class="text-center">
                    <button id="back-to-login-btn" class="text-sm text-gray-500 hover:text-gray-700">
                        Back to Login
                    </button>
                </div>
            </div>
            
            <!-- Force Password Change Form -->
            <div id="force-password-change" class="hidden space-y-4">
                <div class="text-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">Password Change Required</h2>
                    <p class="text-sm text-gray-600">You must change your password before continuing</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Current Password</label>
                    <input type="password" id="force-current-password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Enter current password">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">New Password</label>
                    <input type="password" id="force-new-password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Enter new password">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Confirm New Password</label>
                    <input type="password" id="force-confirm-password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Confirm new password">
                </div>
                
                <div id="force-password-requirements" class="text-xs text-gray-600 bg-blue-50 p-2 rounded">
                    <!-- Password requirements will be loaded here -->
                </div>
                
                <button id="force-change-password-btn" class="w-full bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600 transition-colors">
                    Change Password
=======
                <button onclick="window.location.reload()" class="w-full bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600 transition-colors">
                    Retry Authentication
>>>>>>> 114797d (added authelia)
                </button>
                <div class="text-center">
                    <p class="text-sm text-gray-600">
                        Contact your administrator if you continue to have authentication issues.
                    </p>
                </div>
            </div>
        </div>

        <!-- Main App Screen -->
        <div id="main-screen" class="hidden">
            <!-- Header -->
            <header class="bg-blue-500 text-white p-4">
                <div class="flex items-center justify-between">
                    <h1 class="text-xl font-bold">Workout Tracker</h1>
                    <div class="flex items-center space-x-3">
                        <span id="user-display" class="text-sm font-medium"></span>
                        <button id="logout-btn" class="text-sm bg-blue-600 px-3 py-1 rounded hover:bg-blue-700">
                            Logout
                        </button>
                    </div>
                </div>
            </header>

            <!-- Navigation -->
            <nav class="bg-white border-b border-gray-200">
                <div class="flex">
                    <button class="nav-btn flex-1 py-2 px-1 text-center font-medium border-b-2 border-transparent text-gray-500 text-xs" data-tab="templates">
                        üìã<br>Templates
                    </button>
                    <button class="nav-btn flex-1 py-2 px-1 text-center font-medium border-b-2 border-transparent text-gray-500 text-xs" data-tab="workout">
                        üí™<br>Workout
                    </button>
                    <button class="nav-btn flex-1 py-2 px-1 text-center font-medium border-b-2 border-transparent text-gray-500 text-xs" data-tab="history">
                        üìä<br>History
                    </button>
                    <button class="nav-btn flex-1 py-2 px-1 text-center font-medium border-b-2 border-blue-500 text-blue-600 text-xs" data-tab="settings">
                        ‚öôÔ∏è<br>Settings
                    </button>
                    <button class="nav-btn admin-only flex-1 py-3 text-center font-medium border-b-2 border-transparent text-gray-500" data-tab="admin" style="display: none;">
                        Admin
                    </button>
                </div>
            </nav>

            <!-- Content Area -->
            <div id="content" class="p-4 pb-20">
                <!-- Templates Tab -->
                <div id="templates-tab" class="tab-content hidden">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-semibold">Your Templates</h2>
                        <button id="add-template-btn" class="bg-blue-500 text-white px-4 py-2 rounded text-sm hover:bg-blue-600">
                            + Add Template
                        </button>
                    </div>
                    <div id="templates-list" class="space-y-3">
                        <!-- Templates will be loaded here -->
                    </div>
                </div>

                <!-- Workout Tab -->
                <div id="workout-tab" class="tab-content hidden">
                    <div id="template-selection" class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Choose Template</label>
                        <select id="workout-template-select" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            <option value="">Select a template...</option>
                        </select>
                        <button id="start-workout-btn" class="w-full mt-3 bg-green-500 text-white py-2 rounded-md hover:bg-green-600 disabled:bg-gray-300" disabled>
                            Start Workout
                        </button>
                    </div>

                    <div id="workout-session" class="hidden">
                        <div class="bg-blue-50 p-3 rounded-md mb-4">
                            <p class="text-sm text-blue-800"><span class="font-medium">Started:</span> <span id="session-time"></span></p>
                            <p class="text-sm text-blue-800"><span class="font-medium">Template:</span> <span id="session-template"></span></p>
                        </div>

                        <div id="exercises-list" class="space-y-4 mb-6">
                            <!-- Exercise rows will be loaded here -->
                        </div>

                        <div class="flex space-x-3">
                            <button id="save-session-btn" class="flex-1 bg-green-500 text-white py-3 rounded-md hover:bg-green-600">
                                Save Session
                            </button>
                            <button id="cancel-session-btn" class="px-6 bg-gray-500 text-white py-3 rounded-md hover:bg-gray-600">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>

                <!-- History Tab -->
                <div id="history-tab" class="tab-content hidden">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-semibold">Workout History</h2>
                        <select id="history-filter" class="px-3 py-1 border border-gray-300 rounded text-sm">
                            <option value="">All Templates</option>
                        </select>
                    </div>
                    <div id="sessions-list" class="space-y-3">
                        <!-- Sessions will be loaded here -->
                    </div>
                </div>

<<<<<<< HEAD
                <!-- Settings Tab -->
                <div id="settings-tab" class="tab-content">

                    <h2 class="text-lg font-semibold mb-4">‚öôÔ∏è Settings</h2>
                    
                    <!-- Password Change Section -->
                    <div class="bg-gray-50 rounded-lg p-4 mb-4">
                        <h3 class="text-md font-medium mb-3">Change Password</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Current Password</label>
                                <input type="password" id="current-password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Enter current password">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">New Password</label>
                                <input type="password" id="new-password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Enter new password">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Confirm New Password</label>
                                <input type="password" id="confirm-password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Confirm new password">
                            </div>
                            <div id="password-requirements" class="text-xs text-gray-600 bg-blue-50 p-2 rounded">
                                <!-- Password requirements will be loaded here -->
                            </div>
                            <button id="change-password-btn" class="w-full bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600 transition-colors">
                                Change Password
                            </button>
                        </div>
                    </div>

                    <!-- Admin Section (Only for admins) -->
                    <div id="admin-section" class="bg-gray-50 rounded-lg p-4 mb-4 hidden">
                        <h3 class="text-md font-medium mb-3">üëë User Management</h3>
                        <div class="space-y-3">
                            <button id="add-user-btn" class="w-full bg-green-500 text-white py-2 rounded-md hover:bg-green-600 transition-colors">
                                Add New User
                            </button>
                            <div id="users-list" class="space-y-2">
                                <!-- Users will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Account Section -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-md font-medium mb-3">Account</h3>
                        <button id="logout-settings-btn" class="w-full bg-red-500 text-white py-2 rounded-md hover:bg-red-600 transition-colors">
                            Logout
                        </button>
=======
                <!-- Admin Tab -->
                <div id="admin-tab" class="tab-content hidden admin-only" style="display: none;">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-semibold">User Management</h2>
                        <div class="text-sm text-gray-600">Manage application users</div>
                    </div>
                    <div id="admin-users-list" class="space-y-3">
                        <!-- Users will be loaded here -->
>>>>>>> 114797d (added authelia)
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Template Modal -->
    <div id="template-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="fixed bottom-0 left-0 right-0 bg-white rounded-t-lg p-6 max-h-[80vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold" id="modal-title">Add Template</h3>
                <button id="close-modal-btn" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Template Name</label>
                    <input type="text" id="template-name" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="e.g., Push Day">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Exercises</label>
                    <div id="exercises-inputs" class="space-y-2">
                        <!-- Exercise inputs will be added here -->
                    </div>
                    <button id="add-exercise-btn" class="mt-2 text-blue-500 text-sm hover:text-blue-600">
                        + Add Exercise
                    </button>
                </div>

                <div class="flex space-x-3 pt-4">
                    <button id="save-template-btn" class="flex-1 bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600">
                        Save Template
                    </button>
                    <button id="cancel-template-btn" class="px-6 bg-gray-500 text-white py-2 rounded-md hover:bg-gray-600">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Management Modal -->
    <div id="user-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="fixed bottom-0 left-0 right-0 bg-white rounded-t-lg p-6 max-h-[80vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold" id="user-modal-title">Add User</h3>
                <button id="close-user-modal-btn" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                    <input type="text" id="user-username" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Enter username">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="user-email" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Enter email">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
                    <select id="user-role" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        <option value="user">User</option>
                        <option value="admin">Administrator</option>
                    </select>
                </div>

                <div id="password-section">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Temporary Password</label>
                    <input type="password" id="user-password" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Enter temporary password">
                    <p class="text-xs text-gray-500 mt-1">User will be required to change this on first login</p>
                </div>

                <div class="flex space-x-3 pt-4">
                    <button id="save-user-btn" class="flex-1 bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600">
                        Save User
                    </button>
                    <button id="cancel-user-btn" class="px-6 bg-gray-500 text-white py-2 rounded-md hover:bg-gray-600">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Password Reset Modal (for users via query param) -->
    <div id="reset-password-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="fixed bottom-0 left-0 right-0 bg-white rounded-t-lg p-6 max-h-[80vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold">Reset Your Password</h3>
                <button id="close-reset-modal-btn" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">New Password</label>
                    <input type="password" id="reset-new-password" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Enter new password">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                    <input type="password" id="reset-confirm-password" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Confirm new password">
                </div>

                <div id="reset-password-requirements" class="text-xs text-gray-600 bg-blue-50 p-2 rounded">
                    <!-- Password requirements will be loaded here -->
                </div>

                <div class="flex space-x-3 pt-4">
                    <button id="complete-reset-btn" class="flex-1 bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600">
                        Reset Password
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="/app.js"></script>
</body>
</html>
