# Authelia nginx location configuration
# Place this file in /etc/nginx/authelia-location.conf

# Send the request to Authelia for verification
auth_request /authelia;

# Set variables based on Authelia response
auth_request_set $user $upstream_http_remote_user;
auth_request_set $groups $upstream_http_remote_groups;
auth_request_set $name $upstream_http_remote_name;
auth_request_set $email $upstream_http_remote_email;

# Inject the user information into the request as headers
proxy_set_header Remote-User $user;
proxy_set_header Remote-Groups $groups;
proxy_set_header Remote-Name $name;
proxy_set_header Remote-Email $email;

# If Authelia returns 401, redirect to the sign-in page
error_page 401 =302 https://auth.yourdomain.com/?rd=$scheme://$http_host$request_uri;

# If Authelia returns 403, show a forbidden page
error_page 403 = @forbidden;

location @forbidden {
    return 403 "Access denied";
    add_header Content-Type text/plain always;
}
